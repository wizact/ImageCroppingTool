/*! htmllibs - v1.0.0 - 2015-10-19 */ function ImageLoader(a,b,c,d){"use strict";this.cb=c,this.width=300,this.height=30,void 0!==d&&(this.width=d.width||this.width,this.height=d.height||this.height),this.fileElement=a,this.dropElement=b;var e=document.getElementById(this.dropElement);e.style.width=this.width+"px",e.style.height=this.height+"px",document.getElementById(this.fileElement).style.width=this.width+"px"}ImageLoader.prototype.loadFile=function(a){"use strict";var b=new FileReader;if(!a.type.match("image.*"))throw"File type not supported";b.onload=function(){return function(a){return this.cb(a.target.result)}}(a).bind(this),b.readAsDataURL(a)},ImageLoader.prototype.handleFileChange=function(a){"use strict";if(!(a.target.files.length<1)){var b=a.target.files[0];this.loadFile(b)}},ImageLoader.prototype.handleDragOver=function(a){"use strict";a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"},ImageLoader.prototype.handleDropFile=function(a){"use strict";if(a.stopPropagation(),a.preventDefault(),a.dataTransfer.files.length<1)return void console.log("no file has been selected");var b=a.dataTransfer.files[0];this.loadFile(b)},ImageLoader.prototype.init=function(){"use strict";if(document.getElementById(this.fileElement).addEventListener("change",function(a){this.handleFileChange(a)}.bind(this),!1),""!==this.dropElement){var a=document.getElementById(this.dropElement);a.addEventListener("dragover",function(a){this.handleDragOver(a)}.bind(this),!0),a.addEventListener("drop",function(a){this.handleDropFile(a)}.bind(this),!0)}},ImageLoader.prototype.isSupported=function(){"use strict";return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1};var canvasEventModule=function(){"use strict";var a={imageMoveState:!1,activeElementToMove:"",prevX:0,prevY:0,deltaX:0,deltaY:0},b={imageResizeState:!1,type:"",activeElementToResize:"",prevX:0,prevY:0,deltaX:0,deltaY:0},c=function(a){return"se"===a||"ne"===a||"nw"===a||"sw"===a},d=function(){a.imageMoveState=!1,b.imageResizeState=!1},e=function(d){if(a.imageMoveState){a.deltaX=d.pageX-a.prevX,a.deltaY=d.pageY-a.prevY;var e=document.getElementById(a.activeElementToMove);e.style.left=e.offsetLeft+a.deltaX+"px",e.style.top=e.offsetTop+a.deltaY+"px",a.prevX=d.pageX,a.prevY=d.pageY}else if(b.imageResizeState&&""!==b.activeElementToResize){var f=document.getElementById(b.activeElementToResize),g=parseInt(window.getComputedStyle(f,null).getPropertyValue("width"),10),h=parseInt(window.getComputedStyle(f,null).getPropertyValue("height"),10),i=parseInt(window.getComputedStyle(f,null).getPropertyValue("top"),10),j=parseInt(window.getComputedStyle(f,null).getPropertyValue("left"),10);if(c(b.type)){var k=g/h;b.deltaX=d.pageX-b.prevX,b.deltaY=d.pageY-b.prevY,!d.shiftKey||"se"!==b.type&&"nw"!==b.type||(b.deltaX=k*b.deltaY),!d.shiftKey||"ne"!==b.type&&"sw"!==b.type||(b.deltaX=-1*k*b.deltaY)}switch(b.type){case"se":f.style.width=g+b.deltaX+"px",f.style.height=h+b.deltaY+"px",b.prevX=d.pageX,b.prevY=d.pageY;break;case"ne":f.style.height=h-b.deltaY+"px",f.style.width=g+b.deltaX+"px",f.style.top=i+b.deltaY+"px";break;case"nw":f.style.left=j+b.deltaX+"px",f.style.height=h-b.deltaY+"px",f.style.width=g-b.deltaX+"px",f.style.top=i+b.deltaY+"px";break;case"sw":f.style.left=j+b.deltaX+"px",f.style.height=h+b.deltaY+"px",f.style.width=g-b.deltaX+"px"}c(b.type)&&(b.prevX=d.pageX,b.prevY=d.pageY)}};return{handleMouseUp:d,handleMouseMove:e,moveState:a,resizeState:b}}();document.addEventListener("mousemove",canvasEventModule.handleMouseMove,!1),document.addEventListener("mouseup",canvasEventModule.handleMouseUp,!1);var ImagePreview=function(){"use strict";function a(a,b){this.width=this.previewWidth=300,this.height=this.previewHeight=30,this.viewFinderWidth=this.width/2,this.viewFinderHeight=this.height/2,void 0!==b?(this.width=b.width||this.width,this.height=b.height||this.height,this.viewFinderWidth=b.viewFinderWidth||this.width/2,this.viewFinderHeight=b.viewFinderHeight||this.height/2,this.previewWidth=b.previewWidth||this.previewWidth,this.previewHeight=b.previewHeight||this.previewHeight):(this.viewFinderWidth=this.width/2,this.viewFinderHeight=this.height/2),this.previewElement=a}return a.prototype.handleMoveMouseDown=function(a){canvasEventModule.moveState.imageMoveState=!0,canvasEventModule.moveState.activeElementToMove=a.currentTarget.id,canvasEventModule.moveState.prevX=a.pageX,canvasEventModule.moveState.prevY=a.pageY},a.prototype.handleResizeMouseDown=function(a){a.stopPropagation(),a.preventDefault();var b=a.target;canvasEventModule.resizeState.imageResizeState=!0,canvasEventModule.resizeState.prevX=a.pageX,canvasEventModule.resizeState.prevY=a.pageY,canvasEventModule.resizeState.activeElementToResize=b.parentElement.id;var c=b.id.split("_");canvasEventModule.resizeState.type=c[c.length>0?c.length-1:0]},a.prototype.preparePreview=function(){var a=document.getElementById(this.previewElement+"_resizeContainer");null!==a&&a.remove();var b=document.getElementById(this.previewElement);b.style.width=this.width+"px",b.style.height=this.height+"px"},a.prototype.createHandleBars=function(a,b){var c=document.createElement("span");return c.setAttribute("class",b),c.setAttribute("id",this.previewElement+"_"+a),c},a.prototype.prepareViewFinder=function(){var a=document.createElement("div");a.setAttribute("id",this.previewElement+"_viewFinder"),a.setAttribute("class","viewFinder"),a.setAttribute("draggable","false"),a.style.width=this.viewFinderWidth+"px",a.style.height=this.viewFinderHeight+"px",a.style.left=Math.floor(this.width/2-this.viewFinderWidth/2)+"px",a.style.top=Math.floor(this.height/2-this.viewFinderHeight/2)+"px",document.getElementById(this.previewElement).insertBefore(a,null)},a.prototype.load=function(a){this.prepareViewFinder(),this.preparePreview();var b=new Image;b.setAttribute("id",this.previewElement+"_img"),b.setAttribute("class","imgToResize"),b.setAttribute("draggable","false");var c=document.createElement("div");c.setAttribute("id",this.previewElement+"_resizeContainer"),c.setAttribute("class","containerToResize"),c.setAttribute("draggable","false"),b.onload=function(){var a=b.width,d=b.height,e=this.previewWidth,f=this.previewHeight,g=1;g=a>d?a/this.previewWidth:d/this.previewHeight,f=d/g,e=a/g,b.setAttribute("width","100%"),b.setAttribute("height","100%"),c.style.width=e+"px",c.style.height=f+"px",c.style.left=Math.floor(this.width/2-e/2)+"px",c.style.top=Math.floor(this.height/2-f/2)+"px",document.getElementById(this.previewElement).insertBefore(c,null),c.insertBefore(b,null);var h=this.createHandleBars("nw","resize-handle resize-handle-nw"),i=this.createHandleBars("ne","resize-handle resize-handle-ne"),j=this.createHandleBars("sw","resize-handle resize-handle-sw"),k=this.createHandleBars("se","resize-handle resize-handle-se");c.insertBefore(h,b),c.insertBefore(i,b),c.insertBefore(j,b),c.insertBefore(k,b),c.addEventListener("mousedown",this.handleMoveMouseDown,!1),h.addEventListener("mousedown",this.handleResizeMouseDown,!1),i.addEventListener("mousedown",this.handleResizeMouseDown,!1),j.addEventListener("mousedown",this.handleResizeMouseDown,!1),k.addEventListener("mousedown",this.handleResizeMouseDown,!1)}.bind(this),b.src=a},a.prototype.findImagePositionType=function(a,b,c,d,e,f,g,h){return e>=a&&f>=b&&g>=c&&h>=d?1:e>=a&&f>=b&&g>=c&&d>h?2:e>=a&&f>=b&&c>g&&h>=d?3:e>=a&&f>=b&&c>g&&d>h?4:e>=a&&b>f&&g>=c&&h>=d?5:e>=a&&b>f&&g>=c&&d>h?6:e>=a&&b>f&&c>g&&h>=d?7:e>=a&&b>f&&c>g&&d>h?8:a>e&&f>=b&&g>=c&&h>=d?9:a>e&&f>=b&&g>=c&&d>h?10:a>e&&f>=b&&c>g&&h>=d?11:a>e&&f>=b&&c>g&&d>h?12:a>e&&b>f&&g>=c&&h>=d?13:a>e&&b>f&&g>=c&&d>h?14:a>e&&b>f&&c>g&&h>=d?15:a>e&&b>f&&c>g&&d>h?16:void 0},a.prototype.findImageCoordinates=function(){var a=document.getElementById(this.previewElement+"_resizeContainer"),b=parseInt(a.style.top,10),c=parseInt(a.style.left,10),d=parseInt(a.style.width,10),e=parseInt(a.style.height,10);return{x_image_1:c,y_image_1:b,x_image_2:c+d,y_image_2:b+e}},a.prototype.findViewFinderCoordinates=function(){var a=document.getElementById(this.previewElement+"_viewFinder"),b=parseInt(a.style.top,10),c=parseInt(a.style.left,10),d=parseInt(a.style.width,10),e=parseInt(a.style.height,10);return{x_view_1:c,y_view_1:b,x_view_2:c+d,y_view_2:b+e}},a.prototype.viewFinderAndImageIntersect=function(){var a=this.findImageCoordinates(),b=this.findViewFinderCoordinates();return a.x_image_2<b.x_view_1||b.x_view_2<a.x_image_1||a.y_image_2<b.y_view_1||b.y_view_2<a.y_image_1?!1:!0},a.prototype.viewFinderAndImageIntersectionArea=function(){var a=this.findImageCoordinates(),b=this.findViewFinderCoordinates(),c=Math.max(0,Math.min(a.x_image_2,b.x_view_2)-Math.max(a.x_image_1,b.x_view_1)),d=Math.max(0,Math.min(a.y_image_2,b.y_view_2)-Math.max(a.y_image_1,b.y_view_1));return{x_overlap:c,y_overlap:d,area:c*d}},a}();